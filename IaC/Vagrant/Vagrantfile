# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
    # 1. Ubuntu 22.04 베이스 박스 사용 (Linux Mint 호환)
    config.vm.box = "ubuntu/jammy64"
    
    # 2. 가상 머신 리소스 설정
    config.vm.provider "virtualbox" do |vb|
      vb.memory = "4096"      # 4GB RAM 할당
      vb.cpus = 4             # 2 CPU 코어
      vb.name = "bootc-dev"   # VM 이름 지정
    end
  
    # 3. 네트워크 포트 포워딩 (SSH 접속용)
    config.vm.network "forwarded_port", guest: 22, host: 2222, auto_correct: true
  
    # 4. bootC 필수 패키지 설치 스크립트
    config.vm.provision "shell", inline: <<-SHELL
      # 시스템 업데이트
      sudo apt-get update -y
      sudo apt-get upgrade -y
  
      # bootC 의존성 패키지 설치
      sudo apt-get install -y \
          podman \
          skopeo \
          buildah \
          ostree \
          rpm-ostree \
          git \
          make \
          golang
  
      # bootC 패키지 설치 (공식 저장소 추가)
      sudo apt-add-repository -y ppa:projectatomic/ppa
      sudo apt-get update -y
      sudo apt-get install -y bootc
  
      # SELinux 비활성화 (테스트 환경용)
      sudo sed -i 's/^SELINUX=.*/SELINUX=disabled/' /etc/selinux/config
    SHELL
  
    # 5. 설치 후 확인 스크립트
    config.vm.provision "shell", inline: <<-SHELL
      echo "=== 설치 완료 ==="
      bootc --version
      podman --version
    SHELL
  end
  